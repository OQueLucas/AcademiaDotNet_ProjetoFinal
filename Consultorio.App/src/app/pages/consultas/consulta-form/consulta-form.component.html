<mat-card class="mt-3">
  <mat-card-header>
    <mat-toolbar color="primary">
      <app-titulo [titulo]="titulo"></app-titulo>
    </mat-toolbar>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="form" class="d-flex flex-column gap-3 mt-3">
      <input type="hidden" formControlName="id" #id>

      <fieldset class="d-flex gap-3">

        <mat-form-field class="flex-fill">
          <mat-label>Tipo de Consulta</mat-label>
          <select matNativeControl formControlName="tipoConsulta">
            <option [value]="tipo" *ngFor="let tipo of tipoConsulta">{{ TipoConsultaToLabelMapping[tipo] }}</option>
          </select>
          <mat-error *ngIf="form.get('tipoConsulta')?.invalid">{{formUtils.getErrorMessage(form, "tipoConsulta")}}</mat-error>
        </mat-form-field>

        <mat-form-field class="flex-fill">
          <mat-label>Data</mat-label>
          <input matNativeControl type="datetime-local" formControlName="data">
        </mat-form-field>
      </fieldset>

      <fieldset class="d-flex gap-3">

        <mat-form-field class="flex-fill">
          <mat-label>Medico</mat-label>
          <select matNativeControl formControlName="medicoId" (change)="selecionarMedico($event)">
            <option [value]="medico.id" *ngFor="let medico of medicos">{{ medico.nome }}</option>
          </select>
          <mat-error *ngIf="form.get('medicoId').invalid">{{formUtils.getErrorMessage(form, "medicoId")}}</mat-error>
        </mat-form-field>

        <mat-form-field class="flex-fill">
          <mat-label>CRM</mat-label>
          <input matInput formControlName="medicoCRM" mask="SS 00000" placeholder="SP 00000" readonly>
        </mat-form-field>

        <mat-form-field class="flex-fill">
          <mat-label>Especialização</mat-label>
          <input matInput formControlName="especializacao" readonly>
        </mat-form-field>

      </fieldset>

      <fieldset class="d-flex gap-3">

        <mat-form-field class="flex-fill">
          <mat-label>Paciente</mat-label>
          <select matNativeControl formControlName="pacienteId" (change)="selecionarPaciente($event)">
            <option [value]="paciente.id" *ngFor="let paciente of pacientes">{{ paciente.nome }}</option>
          </select>
          <mat-error *ngIf="form.get('pacienteId')?.invalid">{{formUtils.getErrorMessage(form, "pacienteId")}}</mat-error>
        </mat-form-field>

        <mat-form-field class="flex-fill">
          <mat-label>Nome Social</mat-label>
          <input matInput formControlName="nomeSocial" readonly>
          <mat-error *ngIf="form.get('nomeSocial')?.invalid">{{formUtils.getErrorMessage(form, "nomeSocial")}}</mat-error>
        </mat-form-field>
      </fieldset>

      <fieldset class="d-flex gap-3">

        <mat-form-field class="flex-fill">
          <mat-label>CPF</mat-label>
          <input matInput formControlName="cpf" mask="000.000.000-00" readonly>
        </mat-form-field>

        <mat-form-field>
          <mat-label>Data de Nascimento</mat-label>
          <input matInput [matDatepicker]="dataNascimento" placeholder="DD/MM/AAAA" formControlName="dataNascimento" readonly>
          <mat-hint>DD/MM/AAAA</mat-hint>
          <mat-datepicker #dataNascimento></mat-datepicker>
        </mat-form-field>

      </fieldset>
      <fieldset class="d-flex gap-3">

        <mat-form-field class="flex-fill">
          <mat-label>Gênero</mat-label>
          <select matNativeControl formControlName="genero">
            <option [value]="genero" *ngFor="let genero of generos">{{ GeneroToLabelMapping[genero] }}</option>
          </select>
        </mat-form-field>

        <mat-form-field class="flex-fill">
          <mat-label>Tipo Sanguíneo</mat-label>
          <select matNativeControl formControlName="tipoSanguineo">
            <option [value]="tipo" *ngFor="let tipo of tiposSanguineo">{{ TipoSanguineoToLabelMapping[tipo] }}</option>
          </select>
          <mat-error *ngIf="form.get('tipoSanguineo')?.invalid">{{formUtils.getErrorMessage(form, "tipoSanguineo")}}</mat-error>
        </mat-form-field>

      </fieldset>
      <fieldset class="d-flex gap-3">

        <mat-form-field class="flex-fill">
          <mat-label>Email</mat-label>
          <input matInput formControlName="email" readonly>
        </mat-form-field>

        <mat-form-field class="flex-fill">
          <mat-label>Telefone</mat-label>
          <input matInput formControlName="telefone" readonly>
        </mat-form-field>

      </fieldset>

      <mat-toolbar>
        <span>Sintomas</span>
        <button mat-icon-button color="accent" (click)="addNovoSintoma()">
          <mat-icon aria-label="Adicionar um novo sintoma">add</mat-icon>
        </button>
      </mat-toolbar>

      <table formArrayName="sintomas" *ngFor="let sintoma of getSintomasFormArray(); let i = index">
        <tr [formGroupName]="i">
          <td>
            <mat-form-field class="flex-fill">
              <mat-label>Sintoma</mat-label>
              <select matNativeControl formControlName="sintomaId">
                <option [value]="tipo.id" *ngFor="let tipo of sintomas">{{ tipo.nome }}</option>
              </select>
              <mat-error *ngIf="form.get('sintomaId')?.invalid">{{formUtils.getErrorMessage(form, "sintomaId")}}</mat-error>
            </mat-form-field>
          </td>
          <td>
            <button mat-icon-button color="warn" (click)="removeSintoma(i)">
              <mat-icon aria-label="Adicionar um novo sintoma">delete</mat-icon>
            </button>
          </td>
        </tr>
      </table>

      <mat-form-field class="flex-fill">
        <mat-label>Descrição</mat-label>
        <textarea matInput formControlName="descricao"></textarea>
        <mat-error *ngIf="form.get('descricao')?.invalid">{{formUtils.getErrorMessage(form, "descricao")}}</mat-error>
      </mat-form-field>

    </form>
  </mat-card-content>
  <mat-card-actions class="gap-3">
    <button mat-raised-button color="primary" (click)="onSubmit()">Salvar</button>
    <button mat-raised-button mat-button (click)="onCancel()">Cancelar</button>
  </mat-card-actions>
</mat-card>